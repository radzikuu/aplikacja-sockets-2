<!DOCTYPE html>
<html>
<head>
    <title>Network Protocol Manager</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        .status { padding: 10px; margin: 10px 0; }
        .active { background-color: #4CAF50; color: white; }
        .inactive { background-color: #f44336; color: white; }
        input, select { padding: 8px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Network Protocol Manager</h1>
        
        <div class="section">
            <h2>Connection Status</h2>
            <div id="status"></div>
            <button onclick="checkStatus()">Refresh Status</button>
            <button onclick="autoReconnect()">Auto Reconnect</button>
        </div>
        
        <div class="section">
            <h2>Discover Hosts</h2>
            <button onclick="discoverHosts()">Scan Network</button>
            <div id="hosts"></div>
        </div>
        
        <div class="section">
            <h2>Send Data</h2>
            <input type="text" id="host" placeholder="Host" value="localhost">
            <input type="number" id="port" placeholder="Port" value="5000">
            <select id="protocol">
                <option value="TCP">TCP</option>
                <option value="UDP">UDP</option>
            </select>
            <br>
            <input type="text" id="text" placeholder="Text message">
            <button onclick="sendText()">Send Text (TCP)</button>
            <br>
            <input type="file" id="file">
            <button onclick="sendFile()">Send File</button>
        </div>
    </div>
    
    <script>
        async function checkStatus() {
            const response = await fetch('/api/status');
            const data = await response.json();
            const statusDiv = document.getElementById('status');
            
            let html = '<h3>Active Connections:</h3>';
            for (let [addr, info] of Object.entries(data.connections)) {
                const statusClass = info.active ? 'active' : 'inactive';
                html += `<div class="status ${statusClass}">
                    ${addr} - ${info.type} - ${info.active ? 'Active' : 'Inactive'}
                </div>`;
            }
            statusDiv.innerHTML = html;
        }
        
        async function discoverHosts() {
            const response = await fetch('/api/discover');
            const data = await response.json();
            const hostsDiv = document.getElementById('hosts');
            
            hostsDiv.innerHTML = '<h3>Discovered Hosts:</h3>' + 
                data.hosts.map(h => `<div>${h}</div>`).join('');
        }
        
        async function sendText() {
            const formData = new FormData();
            formData.append('host', document.getElementById('host').value);
            formData.append('port', document.getElementById('port').value);
            formData.append('protocol', document.getElementById('protocol').value);
            formData.append('text', document.getElementById('text').value);
            
            const response = await fetch('/api/send', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            alert(result.success ? 'Sent!' : 'Failed');
        }
        
        async function sendFile() {
            const formData = new FormData();
            formData.append('host', document.getElementById('host').value);
            formData.append('port', document.getElementById('port').value);
            formData.append('protocol', document.getElementById('protocol').value);
            formData.append('file', document.getElementById('file').files[0]);
            
            const response = await fetch('/api/send', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            alert(result.success ? 'File sent!' : 'Failed');
        }
        
        function autoReconnect() {
            alert('Auto-reconnect is enabled by default in the client');
        }
        
        // Auto-refresh status every 5 seconds
        setInterval(checkStatus, 5000);
        checkStatus();
    </script>
</body>
</html>
